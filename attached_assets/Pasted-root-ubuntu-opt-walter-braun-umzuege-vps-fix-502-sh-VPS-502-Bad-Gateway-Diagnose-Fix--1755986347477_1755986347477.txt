root@ubuntu:/opt/walter-braun-umzuege# ./vps-fix-502.sh
ğŸ”§ VPS 502 Bad Gateway Diagnose & Fix
=====================================

ğŸ” Schritt 1: Container Status prÃ¼fen
Container Status:
NAME                 IMAGE                      COMMAND                  SERVICE    CREATED         STATUS                          PORTS
walter_braun_db      postgres:15-alpine         "docker-entrypoint.sâ€¦"   postgres   2 minutes ago   Up 2 minutes                    0.0.0.0:5432->5432/tcp, [::]:5432->5432/tcp
walter_braun_nginx   nginx:alpine               "/docker-entrypoint.â€¦"   nginx      2 minutes ago   Up 2 minutes                    0.0.0.0:80->80/tcp, [::]:80->80/tcp, 0.0.0.0:443->443/tcp, [::]:443->443/tcp
walter_braun_web     walter-braun-umzuege-web   "docker-entrypoint.sâ€¦"   web        2 minutes ago   Restarting (1) 11 seconds ago

ğŸ” Schritt 2: Web Container Logs anzeigen
Letzte 20 Log-Zeilen vom Web Container:
walter_braun_web  | 9:56:55 PM [express]   GET /api/blog/:slug
walter_braun_web  | 9:56:55 PM [express] ğŸ“ Setting up static files from: /app/dist/public
walter_braun_web  | 9:56:55 PM [express] âœ… Static file serving configured
walter_braun_web  | 9:56:55 PM [express] ğŸ¤– Starting automated blog system...
walter_braun_web  | 9:56:55 PM [error] Server Start Error: startBlogScheduler is not a function
walter_braun_web  | 9:57:47 PM [express] âœ… SEO routes registered
walter_braun_web  | 9:57:47 PM [express] âœ… API routes registered
walter_braun_web  | 9:57:47 PM [express] ğŸ“‹ Registered API routes:
walter_braun_web  | 9:57:47 PM [express]   POST /api/contact
walter_braun_web  | 9:57:47 PM [express]   GET /api/contact-submissions
walter_braun_web  | 9:57:47 PM [express]   GET /api/blog
walter_braun_web  | 9:57:47 PM [express]   GET /api/blog/debug
walter_braun_web  | 9:57:47 PM [express]   GET /api/blog/categories
walter_braun_web  | 9:57:47 PM [express]   POST /api/blog/generate
walter_braun_web  | 9:57:47 PM [express]   GET /api/blog/topics
walter_braun_web  | 9:57:47 PM [express]   GET /api/blog/:slug
walter_braun_web  | 9:57:47 PM [express] ğŸ“ Setting up static files from: /app/dist/public
walter_braun_web  | 9:57:47 PM [express] âœ… Static file serving configured
walter_braun_web  | 9:57:47 PM [express] ğŸ¤– Starting automated blog system...
walter_braun_web  | 9:57:47 PM [error] Server Start Error: startBlogScheduler is not a function

ğŸ” Schritt 3: Interne Container-KonnektivitÃ¤t testen
âŒ Web Container NICHT intern erreichbar

ğŸ” Schritt 4: Web Container neustarten
[+] Restarting 1/1
 âœ” Container walter_braun_web  Started                                                                                                                                                        0.2s
âŒ Web Container noch immer nicht erreichbar

ğŸ” Schritt 5: Kompletter Neustart aller Container
[+] Running 4/4
 âœ” Container walter_braun_nginx                       Removed                                                                                                                                 0.3s
 âœ” Container walter_braun_web                         Removed                                                                                                                                 0.0s
 âœ” Container walter_braun_db                          Removed                                                                                                                                 0.2s
 âœ” Network walter-braun-umzuege_walter_braun_network  Removed                                                                                                                                 0.3s
[+] Running 4/4
 âœ” Network walter-braun-umzuege_walter_braun_network  Created                                                                                                                                 0.0s
 âœ” Container walter_braun_db                          Started                                                                                                                                 0.2s
 âœ” Container walter_braun_web                         Started                                                                                                                                 0.5s
 âœ” Container walter_braun_nginx                       Started                                                                                                                                 0.7s
âœ… Alle Container neugestartet, warte 15 Sekunden...

ğŸ” Schritt 6: Finale Tests
HTTP Status: 301
API Status: 301
Localhost Status: 301

âŒ âŒ Problem besteht weiterhin

ğŸ” ZusÃ¤tzliche Diagnose:
1. Container Status:
<no value>           STATUS                         PORTS
walter_braun_db      Up 15 seconds                  0.0.0.0:5432->5432/tcp, [::]:5432->5432/tcp
walter_braun_nginx   Up 15 seconds                  0.0.0.0:80->80/tcp, [::]:80->80/tcp, 0.0.0.0:443->443/tcp, [::]:443->443/tcp
walter_braun_web     Restarting (1) 2 seconds ago

2. Aktuelle nginx.conf:
--- nginx.conf upstream ---
    upstream walter_braun_app {
        server web:5000;
    }

    # Rate limiting
    limit_req_zone $binary_remote_addr zone=api:10m rate=10r/s;
--- nginx.conf server ---
    server {
        listen 80;
        server_name _;

        # Security headers
        add_header X-Frame-Options "SAMEORIGIN" always;
        add_header X-XSS-Protection "1; mode=block" always;
        add_header X-Content-Type-Options "nosniff" always;
        add_header Referrer-Policy "no-referrer-when-downgrade" always;
        add_header Content-Security-Policy "default-src 'self' http: https: data: blob: 'unsafe-inline'" always;


ğŸ’¡ Wenn Problem weiterhin besteht:
   - docker compose logs -f web    # Live-Logs anzeigen
   - docker compose down && docker compose up -d    # Kompletter Neustart
   - docker exec -it walter_braun_web curl http://localhost:5000/api/blog    # Direkter Test
root@ubuntu:/opt/walter-braun-umzuege# ^C
root@ubuntu:/opt/walter-braun-umzuege#  docker compose logs -f web
walter_braun_web  | 9:58:24 PM [express] âœ… SEO routes registered
walter_braun_web  | 9:58:24 PM [express] âœ… API routes registered
walter_braun_web  | 9:58:24 PM [express] ğŸ“‹ Registered API routes:
walter_braun_web  | 9:58:24 PM [express]   POST /api/contact
walter_braun_web  | 9:58:24 PM [express]   GET /api/contact-submissions
walter_braun_web  | 9:58:24 PM [express]   GET /api/blog
walter_braun_web  | 9:58:24 PM [express]   GET /api/blog/debug
walter_braun_web  | 9:58:24 PM [express]   GET /api/blog/categories
walter_braun_web  | 9:58:24 PM [express]   POST /api/blog/generate
walter_braun_web  | 9:58:24 PM [express]   GET /api/blog/topics
walter_braun_web  | 9:58:24 PM [express]   GET /api/blog/:slug
walter_braun_web  | 9:58:24 PM [express] ğŸ“ Setting up static files from: /app/dist/public
walter_braun_web  | 9:58:24 PM [express] âœ… Static file serving configured
walter_braun_web  | 9:58:24 PM [express] ğŸ¤– Starting automated blog system...
walter_braun_web  | 9:58:24 PM [error] Server Start Error: startBlogScheduler is not a function
walter_braun_web  | 9:58:25 PM [express] âœ… SEO routes registered
walter_braun_web  | 9:58:26 PM [express] âœ… API routes registered
walter_braun_web  | 9:58:26 PM [express] ğŸ“‹ Registered API routes:
walter_braun_web  | 9:58:26 PM [express]   POST /api/contact
walter_braun_web  | 9:58:26 PM [express]   GET /api/contact-submissions
walter_braun_web  | 9:58:26 PM [express]   GET /api/blog
walter_braun_web  | 9:58:26 PM [express]   GET /api/blog/debug
walter_braun_web  | 9:58:26 PM [express]   GET /api/blog/categories
walter_braun_web  | 9:58:26 PM [express]   POST /api/blog/generate
walter_braun_web  | 9:58:26 PM [express]   GET /api/blog/topics
walter_braun_web  | 9:58:26 PM [express]   GET /api/blog/:slug
walter_braun_web  | 9:58:26 PM [express] ğŸ“ Setting up static files from: /app/dist/public
walter_braun_web  | 9:58:26 PM [express] âœ… Static file serving configured
walter_braun_web  | 9:58:26 PM [express] ğŸ¤– Starting automated blog system...
walter_braun_web  | 9:58:26 PM [error] Server Start Error: startBlogScheduler is not a function
walter_braun_web  | 9:58:27 PM [express] âœ… SEO routes registered
walter_braun_web  | 9:58:27 PM [express] âœ… API routes registered
walter_braun_web  | 9:58:27 PM [express] ğŸ“‹ Registered API routes:
walter_braun_web  | 9:58:27 PM [express]   POST /api/contact
walter_braun_web  | 9:58:27 PM [express]   GET /api/contact-submissions
walter_braun_web  | 9:58:27 PM [express]   GET /api/blog
walter_braun_web  | 9:58:27 PM [express]   GET /api/blog/debug
walter_braun_web  | 9:58:27 PM [express]   GET /api/blog/categories
walter_braun_web  | 9:58:27 PM [express]   POST /api/blog/generate
walter_braun_web  | 9:58:27 PM [express]   GET /api/blog/topics
walter_braun_web  | 9:58:27 PM [express]   GET /api/blog/:slug
walter_braun_web  | 9:58:27 PM [express] ğŸ“ Setting up static files from: /app/dist/public
walter_braun_web  | 9:58:27 PM [express] âœ… Static file serving configured
walter_braun_web  | 9:58:27 PM [express] ğŸ¤– Starting automated blog system...
walter_braun_web  | 9:58:27 PM [error] Server Start Error: startBlogScheduler is not a function
walter_braun_web  | 9:58:28 PM [express] âœ… SEO routes registered
walter_braun_web  | 9:58:28 PM [express] âœ… API routes registered
walter_braun_web  | 9:58:28 PM [express] ğŸ“‹ Registered API routes:
walter_braun_web  | 9:58:28 PM [express]   POST /api/contact
walter_braun_web  | 9:58:28 PM [express]   GET /api/contact-submissions
walter_braun_web  | 9:58:28 PM [express]   GET /api/blog
walter_braun_web  | 9:58:28 PM [express]   GET /api/blog/debug
walter_braun_web  | 9:58:28 PM [express]   GET /api/blog/categories
walter_braun_web  | 9:58:28 PM [express]   POST /api/blog/generate
walter_braun_web  | 9:58:28 PM [express]   GET /api/blog/topics
walter_braun_web  | 9:58:28 PM [express]   GET /api/blog/:slug
walter_braun_web  | 9:58:28 PM [express] ğŸ“ Setting up static files from: /app/dist/public
walter_braun_web  | 9:58:28 PM [express] âœ… Static file serving configured
walter_braun_web  | 9:58:28 PM [express] ğŸ¤– Starting automated blog system...
walter_braun_web  | 9:58:28 PM [error] Server Start Error: startBlogScheduler is not a function
walter_braun_web  | 9:58:30 PM [express] âœ… SEO routes registered
walter_braun_web  | 9:58:30 PM [express] âœ… API routes registered
walter_braun_web  | 9:58:30 PM [express] ğŸ“‹ Registered API routes:
walter_braun_web  | 9:58:30 PM [express]   POST /api/contact
walter_braun_web  | 9:58:30 PM [express]   GET /api/contact-submissions
walter_braun_web  | 9:58:30 PM [express]   GET /api/blog
walter_braun_web  | 9:58:30 PM [express]   GET /api/blog/debug
walter_braun_web  | 9:58:30 PM [express]   GET /api/blog/categories
walter_braun_web  | 9:58:30 PM [express]   POST /api/blog/generate
walter_braun_web  | 9:58:30 PM [express]   GET /api/blog/topics
walter_braun_web  | 9:58:30 PM [express]   GET /api/blog/:slug
walter_braun_web  | 9:58:30 PM [express] ğŸ“ Setting up static files from: /app/dist/public
walter_braun_web  | 9:58:30 PM [express] âœ… Static file serving configured
walter_braun_web  | 9:58:30 PM [express] ğŸ¤– Starting automated blog system...
walter_braun_web  | 9:58:30 PM [error] Server Start Error: startBlogScheduler is not a function
walter_braun_web  | 9:58:32 PM [express] âœ… SEO routes registered
walter_braun_web  | 9:58:32 PM [express] âœ… API routes registered
walter_braun_web  | 9:58:32 PM [express] ğŸ“‹ Registered API routes:
walter_braun_web  | 9:58:32 PM [express]   POST /api/contact
walter_braun_web  | 9:58:32 PM [express]   GET /api/contact-submissions
walter_braun_web  | 9:58:32 PM [express]   GET /api/blog
walter_braun_web  | 9:58:32 PM [express]   GET /api/blog/debug
walter_braun_web  | 9:58:32 PM [express]   GET /api/blog/categories
walter_braun_web  | 9:58:32 PM [express]   POST /api/blog/generate
walter_braun_web  | 9:58:32 PM [express]   GET /api/blog/topics
walter_braun_web  | 9:58:32 PM [express]   GET /api/blog/:slug
walter_braun_web  | 9:58:32 PM [express] ğŸ“ Setting up static files from: /app/dist/public
walter_braun_web  | 9:58:32 PM [express] âœ… Static file serving configured
walter_braun_web  | 9:58:32 PM [express] ğŸ¤– Starting automated blog system...
walter_braun_web  | 9:58:32 PM [error] Server Start Error: startBlogScheduler is not a function
walter_braun_web  | 9:58:36 PM [express] âœ… SEO routes registered
walter_braun_web  | 9:58:36 PM [express] âœ… API routes registered
walter_braun_web  | 9:58:36 PM [express] ğŸ“‹ Registered API routes:
walter_braun_web  | 9:58:36 PM [express]   POST /api/contact
walter_braun_web  | 9:58:36 PM [express]   GET /api/contact-submissions
walter_braun_web  | 9:58:36 PM [express]   GET /api/blog
walter_braun_web  | 9:58:36 PM [express]   GET /api/blog/debug
walter_braun_web  | 9:58:36 PM [express]   GET /api/blog/categories
walter_braun_web  | 9:58:36 PM [express]   POST /api/blog/generate
walter_braun_web  | 9:58:36 PM [express]   GET /api/blog/topics
walter_braun_web  | 9:58:36 PM [express]   GET /api/blog/:slug
walter_braun_web  | 9:58:36 PM [express] ğŸ“ Setting up static files from: /app/dist/public
walter_braun_web  | 9:58:36 PM [express] âœ… Static file serving configured
walter_braun_web  | 9:58:36 PM [express] ğŸ¤– Starting automated blog system...
walter_braun_web  | 9:58:36 PM [error] Server Start Error: startBlogScheduler is not a function
walter_braun_web  | 9:58:44 PM [express] âœ… SEO routes registered
walter_braun_web  | 9:58:44 PM [express] âœ… API routes registered
walter_braun_web  | 9:58:44 PM [express] ğŸ“‹ Registered API routes:
walter_braun_web  | 9:58:44 PM [express]   POST /api/contact
walter_braun_web  | 9:58:44 PM [express]   GET /api/contact-submissions
walter_braun_web  | 9:58:44 PM [express]   GET /api/blog
walter_braun_web  | 9:58:44 PM [express]   GET /api/blog/debug
walter_braun_web  | 9:58:44 PM [express]   GET /api/blog/categories
walter_braun_web  | 9:58:44 PM [express]   POST /api/blog/generate
walter_braun_web  | 9:58:44 PM [express]   GET /api/blog/topics
walter_braun_web  | 9:58:44 PM [express]   GET /api/blog/:slug
walter_braun_web  | 9:58:44 PM [express] ğŸ“ Setting up static files from: /app/dist/public
walter_braun_web  | 9:58:44 PM [express] âœ… Static file serving configured
walter_braun_web  | 9:58:44 PM [express] ğŸ¤– Starting automated blog system...
walter_braun_web  | 9:58:44 PM [error] Server Start Error: startBlogScheduler is not a function
^C^Croot@ubuntu:/opt/walter-braun-umzuege#
